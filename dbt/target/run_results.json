{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.11.3", "generated_at": "2026-02-06T20:36:03.989566Z", "invocation_id": "4c0918b5-21c1-4ae3-818b-e0c1db2ca6ef", "invocation_started_at": "2026-02-06T20:36:01.060709Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.118676Z", "completed_at": "2026-02-06T20:36:03.127117Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.127623Z", "completed_at": "2026-02-06T20:36:03.127634Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010872840881347656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_home_health_care", "compiled": true, "compiled_code": "with source as (\n    select * from AI_FACTORY_DB.BRONZE.HOME_HEALTH_CARE\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_home_health_care", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.124012Z", "completed_at": "2026-02-06T20:36:03.127966Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.128806Z", "completed_at": "2026-02-06T20:36:03.128810Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.011348724365234375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_leie", "compiled": true, "compiled_code": "with source as (\n    select * from AI_FACTORY_DB.BRONZE.LEIE\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_leie", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.122760Z", "completed_at": "2026-02-06T20:36:03.128177Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.129223Z", "completed_at": "2026-02-06T20:36:03.129228Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.012000322341918945, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_hospice", "compiled": true, "compiled_code": "with source as (\n    select * from AI_FACTORY_DB.BRONZE.HOSPICE\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_hospice", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.125470Z", "completed_at": "2026-02-06T20:36:03.128654Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.129760Z", "completed_at": "2026-02-06T20:36:03.129764Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01184988021850586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_longterm_care_hospital", "compiled": true, "compiled_code": "with source as (\n    select * from AI_FACTORY_DB.BRONZE.LONGTERM_CARE_HOSPITAL\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_longterm_care_hospital", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.131285Z", "completed_at": "2026-02-06T20:36:03.134611Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.137214Z", "completed_at": "2026-02-06T20:36:03.137219Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0077588558197021484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_medicare_hospital_spending", "compiled": true, "compiled_code": "with source as (\n    select * from AI_FACTORY_DB.BRONZE.MEDICARE_HOSPITAL_SPENDING\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_medicare_hospital_spending", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.133357Z", "completed_at": "2026-02-06T20:36:03.138339Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.139046Z", "completed_at": "2026-02-06T20:36:03.139050Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.00821995735168457, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_medicare_part_d_prescribers", "compiled": true, "compiled_code": "with source as (\n    select * from AI_FACTORY_DB.BRONZE.MEDICARE_PART_D_PRESCRIBERS\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_medicare_part_d_prescribers", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.134788Z", "completed_at": "2026-02-06T20:36:03.138830Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.140729Z", "completed_at": "2026-02-06T20:36:03.140733Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009676694869995117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_nppes_provider", "compiled": true, "compiled_code": "with source as (\n    select * from AFFINE_NPPES_PROVIDER_DATA.REF_DW.DIM_PROVIDER\n    where IS_ACTIVE = true\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_nppes_provider", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.136010Z", "completed_at": "2026-02-06T20:36:03.139357Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.141255Z", "completed_at": "2026-02-06T20:36:03.141258Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008776664733886719, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_nppes_provider_address", "compiled": true, "compiled_code": "with source as (\n    select * from AFFINE_NPPES_PROVIDER_DATA.REF_DW.DIM_PROVIDER_ADDRESS\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_nppes_provider_address", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.142368Z", "completed_at": "2026-02-06T20:36:03.145789Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.148361Z", "completed_at": "2026-02-06T20:36:03.148365Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008862495422363281, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_nppes_provider_taxonomy", "compiled": true, "compiled_code": "with source as (\n    select * from AFFINE_NPPES_PROVIDER_DATA.REF_DW.DIM_PROVIDER_TAXONOMY\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_nppes_provider_taxonomy", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.144463Z", "completed_at": "2026-02-06T20:36:03.148759Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.149458Z", "completed_at": "2026-02-06T20:36:03.149462Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.007563114166259766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_nppes_taxonomy_code", "compiled": true, "compiled_code": "with source as (\n    select * from AFFINE_NPPES_PROVIDER_DATA.REF_DW.REF_TAXONOMY_CODE\n    where IS_ACTIVE = true\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_nppes_taxonomy_code", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.145956Z", "completed_at": "2026-02-06T20:36:03.149775Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.150545Z", "completed_at": "2026-02-06T20:36:03.150548Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007000923156738281, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_open_payments_general", "compiled": true, "compiled_code": "with source as (\n    select * from AI_FACTORY_DB.BRONZE.OPEN_PAYMENTS_GENERAL\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_open_payments_general", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.147156Z", "completed_at": "2026-02-06T20:36:03.150138Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.151021Z", "completed_at": "2026-02-06T20:36:03.151025Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007076263427734375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_open_payments_ownership", "compiled": true, "compiled_code": "with source as (\n    select * from AI_FACTORY_DB.BRONZE.OPEN_PAYMENTS_OWNERSHIP\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_open_payments_ownership", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.151826Z", "completed_at": "2026-02-06T20:36:03.155166Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.162069Z", "completed_at": "2026-02-06T20:36:03.162074Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.01219034194946289, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_open_payments_research", "compiled": true, "compiled_code": "with source as (\n    select * from AI_FACTORY_DB.BRONZE.OPEN_PAYMENTS_RESEARCH\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_open_payments_research", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.153894Z", "completed_at": "2026-02-06T20:36:03.162357Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.164936Z", "completed_at": "2026-02-06T20:36:03.164939Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.013564348220825195, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.stg_provider_information", "compiled": true, "compiled_code": "with source as (\n    select * from AI_FACTORY_DB.BRONZE.PROVIDER_INFORMATION\n)\n\nselect\n    *,\n    current_timestamp() as _loaded_at\nfrom source", "relation_name": "AI_FACTORY_DB.STAGING.stg_provider_information", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.155559Z", "completed_at": "2026-02-06T20:36:03.165484Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.166286Z", "completed_at": "2026-02-06T20:36:03.166290Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.01290583610534668, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.hospital_spending", "compiled": true, "compiled_code": "\n\n/*\n    Silver Hospital Spending\n    -------------------------\n    Cleaned Medicare hospital spending data with benchmarks.\n    Identifies hospitals with spending anomalies.\n*/\n\nwith spending as (\n    select * from AI_FACTORY_DB.STAGING.stg_medicare_hospital_spending\n),\n\ncleaned as (\n    select\n        -- Generate unique ID\n        md5(cast(coalesce(cast(FACILITY_ID as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(CLAIM_TYPE as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(PERIOD as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as SPENDING_ID,\n\n        -- Hospital identification\n        FACILITY_ID as CCN,\n        FACILITY_NAME as HOSPITAL_NAME,\n\n        -- Address\n        ADDRESS,\n        CITY,\n        STATE,\n        ZIP_CODE,\n        COUNTY_NAME as COUNTY,\n        PHONE_NUMBER as PHONE,\n\n        -- Spending category\n        CLAIM_TYPE,\n        PERIOD,\n\n        -- Spending amounts\n        try_to_number(AVG_SPENDING_PER_EPISODE_HOSPITAL, 18, 2) as AVG_SPENDING_HOSPITAL,\n        try_to_number(AVG_SPENDING_PER_EPISODE_STATE, 18, 2) as AVG_SPENDING_STATE,\n        try_to_number(AVG_SPENDING_PER_EPISODE_NATION, 18, 2) as AVG_SPENDING_NATION,\n\n        -- Spending percentages\n        try_to_number(PERCENT_OF_SPENDING_HOSPITAL, 18, 4) as PCT_SPENDING_HOSPITAL,\n        try_to_number(PERCENT_OF_SPENDING_STATE, 18, 4) as PCT_SPENDING_STATE,\n        try_to_number(PERCENT_OF_SPENDING_NATION, 18, 4) as PCT_SPENDING_NATION,\n\n        -- Dates\n        try_to_date(START_DATE, 'YYYY-MM-DD') as PERIOD_START_DATE,\n        try_to_date(END_DATE, 'YYYY-MM-DD') as PERIOD_END_DATE,\n\n        _LOAD_TIMESTAMP\n\n    from spending\n    where STATE is not null\n      and FACILITY_ID is not null  -- Filter out null CCNs\n),\n\nwith_benchmarks as (\n    select\n        *,\n\n        -- Variance from benchmarks\n        case\n            when AVG_SPENDING_STATE > 0 then round((AVG_SPENDING_HOSPITAL - AVG_SPENDING_STATE) / AVG_SPENDING_STATE * 100, 2)\n            else null\n        end as PCT_VARIANCE_FROM_STATE,\n\n        case\n            when AVG_SPENDING_NATION > 0 then round((AVG_SPENDING_HOSPITAL - AVG_SPENDING_NATION) / AVG_SPENDING_NATION * 100, 2)\n            else null\n        end as PCT_VARIANCE_FROM_NATION,\n\n        -- Spending efficiency\n        case\n            when AVG_SPENDING_HOSPITAL < AVG_SPENDING_STATE then 'BELOW_STATE_AVG'\n            when AVG_SPENDING_HOSPITAL > AVG_SPENDING_STATE * 1.2 then 'ABOVE_STATE_AVG_20PCT'\n            else 'AT_STATE_AVG'\n        end as STATE_BENCHMARK_STATUS,\n\n        case\n            when AVG_SPENDING_HOSPITAL < AVG_SPENDING_NATION then 'BELOW_NATIONAL_AVG'\n            when AVG_SPENDING_HOSPITAL > AVG_SPENDING_NATION * 1.2 then 'ABOVE_NATIONAL_AVG_20PCT'\n            else 'AT_NATIONAL_AVG'\n        end as NATIONAL_BENCHMARK_STATUS\n\n    from cleaned\n),\n\nfinal as (\n    select\n        SPENDING_ID,\n\n        -- Hospital info\n        CCN,\n        HOSPITAL_NAME,\n        ADDRESS,\n        CITY,\n        STATE,\n        ZIP_CODE,\n        COUNTY,\n        PHONE,\n\n        -- Spending category\n        CLAIM_TYPE,\n        PERIOD,\n\n        -- Spending amounts\n        AVG_SPENDING_HOSPITAL,\n        AVG_SPENDING_STATE,\n        AVG_SPENDING_NATION,\n\n        -- Spending percentages\n        PCT_SPENDING_HOSPITAL,\n        PCT_SPENDING_STATE,\n        PCT_SPENDING_NATION,\n\n        -- Benchmarks\n        PCT_VARIANCE_FROM_STATE,\n        PCT_VARIANCE_FROM_NATION,\n        STATE_BENCHMARK_STATUS,\n        NATIONAL_BENCHMARK_STATUS,\n\n        -- Risk flags\n        case\n            when PCT_VARIANCE_FROM_NATION > 50 then true\n            else false\n        end as IS_HIGH_SPENDER,\n\n        case\n            when PCT_VARIANCE_FROM_NATION > 50 then 'HIGH'\n            when PCT_VARIANCE_FROM_NATION > 20 then 'MEDIUM'\n            when PCT_VARIANCE_FROM_NATION < -20 then 'LOW'\n            else 'NORMAL'\n        end as SPENDING_RISK_TIER,\n\n        -- Dates\n        PERIOD_START_DATE,\n        PERIOD_END_DATE,\n\n        -- Metadata\n        current_timestamp() as _loaded_at\n\n    from with_benchmarks\n    -- Deduplicate: keep one row per SPENDING_ID\n    qualify row_number() over (partition by SPENDING_ID order by _LOAD_TIMESTAMP desc) = 1\n)\n\nselect * from final", "relation_name": "AI_FACTORY_DB.SILVER.hospital_spending", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.162559Z", "completed_at": "2026-02-06T20:36:03.166098Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.169856Z", "completed_at": "2026-02-06T20:36:03.169860Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.016218185424804688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.prescriptions", "compiled": true, "compiled_code": "\n\n/*\n    Silver Prescriptions (Medicare Part D Cleaned)\n    -----------------------------------------------\n    Cleaned and enriched prescription data for fraud pattern detection.\n    Key metrics: prescribing volume, cost per prescription, outlier detection.\n*/\n\nwith prescriptions as (\n    select * from AI_FACTORY_DB.STAGING.stg_medicare_part_d_prescribers\n),\n\nexcluded_npis as (\n    select distinct NPI\n    from AI_FACTORY_DB.STAGING.stg_leie\n    where NPI is not null and NPI != ''\n),\n\ncleaned as (\n    select\n        -- Generate unique ID\n        md5(cast(coalesce(cast(PRSCRBR_NPI as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(BRND_NAME as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(GNRC_NAME as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as PRESCRIPTION_ID,\n\n        -- Prescriber info\n        PRSCRBR_NPI as NPI,\n        PRSCRBR_LAST_ORG_NAME as PRESCRIBER_LAST_NAME,\n        PRSCRBR_FIRST_NAME as PRESCRIBER_FIRST_NAME,\n        concat_ws(' ', PRSCRBR_FIRST_NAME, PRSCRBR_LAST_ORG_NAME) as PRESCRIBER_FULL_NAME,\n        PRSCRBR_CITY as CITY,\n        PRSCRBR_STATE_ABRVTN as STATE,\n        PRSCRBR_TYPE as PRESCRIBER_TYPE,\n\n        -- Drug info\n        BRND_NAME as BRAND_NAME,\n        GNRC_NAME as GENERIC_NAME,\n        case\n            when BRND_NAME is not null and BRND_NAME != GNRC_NAME then 'BRAND'\n            else 'GENERIC'\n        end as DRUG_TYPE,\n\n        -- Volume metrics (all beneficiaries)\n        try_to_number(TOT_CLMS) as TOTAL_CLAIMS,\n        try_to_number(TOT_30DAY_FILLS, 18, 2) as TOTAL_30DAY_FILLS,\n        try_to_number(TOT_DAY_SUPLY) as TOTAL_DAYS_SUPPLY,\n        try_to_number(TOT_DRUG_CST, 18, 2) as TOTAL_DRUG_COST,\n        try_to_number(TOT_BENES) as TOTAL_BENEFICIARIES,\n\n        -- Volume metrics (65+ beneficiaries)\n        try_to_number(GE65_TOT_CLMS) as TOTAL_CLAIMS_65PLUS,\n        try_to_number(GE65_TOT_30DAY_FILLS, 18, 2) as TOTAL_30DAY_FILLS_65PLUS,\n        try_to_number(GE65_TOT_DAY_SUPLY) as TOTAL_DAYS_SUPPLY_65PLUS,\n        try_to_number(GE65_TOT_DRUG_CST, 18, 2) as TOTAL_DRUG_COST_65PLUS,\n        try_to_number(GE65_TOT_BENES) as TOTAL_BENEFICIARIES_65PLUS,\n\n        -- Suppression flags\n        GE65_SPRSN_FLAG as SUPPRESSION_FLAG_65PLUS,\n        GE65_BENE_SPRSN_FLAG as BENE_SUPPRESSION_FLAG_65PLUS,\n\n        _LOAD_TIMESTAMP\n\n    from prescriptions\n    where PRSCRBR_NPI is not null and PRSCRBR_NPI != ''\n),\n\nwith_metrics as (\n    select\n        *,\n\n        -- Calculated metrics\n        case\n            when TOTAL_CLAIMS > 0 then round(TOTAL_DRUG_COST / TOTAL_CLAIMS, 2)\n            else 0\n        end as AVG_COST_PER_CLAIM,\n\n        case\n            when TOTAL_BENEFICIARIES > 0 then round(TOTAL_DRUG_COST / TOTAL_BENEFICIARIES, 2)\n            else 0\n        end as AVG_COST_PER_BENEFICIARY,\n\n        case\n            when TOTAL_BENEFICIARIES > 0 then round(TOTAL_CLAIMS / TOTAL_BENEFICIARIES, 2)\n            else 0\n        end as AVG_CLAIMS_PER_BENEFICIARY,\n\n        case\n            when TOTAL_30DAY_FILLS > 0 then round(TOTAL_DAYS_SUPPLY / TOTAL_30DAY_FILLS, 2)\n            else 0\n        end as AVG_DAYS_PER_FILL\n\n    from cleaned\n),\n\nfinal as (\n    select\n        m.PRESCRIPTION_ID,\n\n        -- Prescriber\n        m.NPI,\n        m.PRESCRIBER_LAST_NAME,\n        m.PRESCRIBER_FIRST_NAME,\n        m.PRESCRIBER_FULL_NAME,\n        m.CITY,\n        m.STATE,\n        m.PRESCRIBER_TYPE,\n\n        -- Drug\n        m.BRAND_NAME,\n        m.GENERIC_NAME,\n        m.DRUG_TYPE,\n\n        -- Volume - All\n        m.TOTAL_CLAIMS,\n        m.TOTAL_30DAY_FILLS,\n        m.TOTAL_DAYS_SUPPLY,\n        m.TOTAL_DRUG_COST,\n        m.TOTAL_BENEFICIARIES,\n\n        -- Volume - 65+\n        m.TOTAL_CLAIMS_65PLUS,\n        m.TOTAL_30DAY_FILLS_65PLUS,\n        m.TOTAL_DAYS_SUPPLY_65PLUS,\n        m.TOTAL_DRUG_COST_65PLUS,\n        m.TOTAL_BENEFICIARIES_65PLUS,\n\n        -- Calculated metrics\n        m.AVG_COST_PER_CLAIM,\n        m.AVG_COST_PER_BENEFICIARY,\n        m.AVG_CLAIMS_PER_BENEFICIARY,\n        m.AVG_DAYS_PER_FILL,\n\n        -- Fraud detection flags\n        case when e.NPI is not null then true else false end as IS_PRESCRIBER_EXCLUDED,\n\n        -- High volume flags (potential fraud indicators)\n        case when m.TOTAL_CLAIMS > 1000 then true else false end as IS_HIGH_VOLUME_PRESCRIBER,\n        case when m.AVG_COST_PER_CLAIM > 500 then true else false end as IS_HIGH_COST_PRESCRIBER,\n        case when m.AVG_CLAIMS_PER_BENEFICIARY > 10 then true else false end as IS_HIGH_CLAIMS_PER_BENE,\n\n        -- Risk tier\n        case\n            when e.NPI is not null then 'CRITICAL'\n            when m.TOTAL_DRUG_COST > 1000000 then 'VERY_HIGH'\n            when m.TOTAL_DRUG_COST > 100000 then 'HIGH'\n            when m.TOTAL_DRUG_COST > 10000 then 'MEDIUM'\n            else 'LOW'\n        end as RISK_TIER,\n\n        -- Metadata\n        current_timestamp() as _loaded_at\n\n    from with_metrics m\n    left join excluded_npis e on m.NPI = e.NPI\n)\n\nselect * from final", "relation_name": "AI_FACTORY_DB.SILVER.prescriptions", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.166774Z", "completed_at": "2026-02-06T20:36:03.172936Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.173516Z", "completed_at": "2026-02-06T20:36:03.173519Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008260726928710938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.excluded_providers", "compiled": true, "compiled_code": "\n\n/*\n    Silver Excluded Providers (LEIE Enriched)\n    ------------------------------------------\n    Providers excluded from Medicare/Medicaid, enriched with NPPES data.\n    Critical table for fraud detection - any billing from these providers is suspicious.\n*/\n\nwith leie as (\n    select * from AI_FACTORY_DB.STAGING.stg_leie\n),\n\nnppes_provider as (\n    select * from AI_FACTORY_DB.STAGING.stg_nppes_provider\n),\n\nnppes_address as (\n    select * from AI_FACTORY_DB.STAGING.stg_nppes_provider_address\n    where IS_PRIMARY = true\n),\n\nleie_cleaned as (\n    select\n        -- Generate unique ID\n        md5(cast(coalesce(cast(NPI as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(EXCLDATE as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(LASTNAME as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(FIRSTNAME as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as EXCLUSION_ID,\n\n        -- Provider identifiers\n        NPI,\n        UPIN,\n\n        -- Name fields\n        upper(trim(LASTNAME)) as LAST_NAME,\n        upper(trim(FIRSTNAME)) as FIRST_NAME,\n        upper(trim(MIDNAME)) as MIDDLE_NAME,\n        upper(trim(BUSNAME)) as BUSINESS_NAME,\n\n        -- Provider type\n        GENERAL as PROVIDER_GENERAL_TYPE,\n        SPECIALTY as PROVIDER_SPECIALTY,\n\n        -- Address from LEIE\n        upper(trim(ADDRESS)) as LEIE_ADDRESS,\n        upper(trim(CITY)) as LEIE_CITY,\n        upper(trim(STATE)) as LEIE_STATE,\n        trim(ZIP) as LEIE_ZIP,\n\n        -- Exclusion details\n        EXCLTYPE as EXCLUSION_TYPE_CODE,\n        case EXCLTYPE\n            when '1128a1' then 'Conviction of program-related crimes'\n            when '1128a2' then 'Conviction relating to patient abuse'\n            when '1128a3' then 'Felony conviction relating to health care fraud'\n            when '1128a4' then 'Felony conviction relating to controlled substance'\n            when '1128b1' then 'Misdemeanor conviction relating to health care fraud'\n            when '1128b2' then 'Conviction relating to obstruction of an investigation'\n            when '1128b4' then 'License revocation or suspension'\n            when '1128b5' then 'Exclusion or suspension under federal or state health care program'\n            when '1128b6' then 'Claims for excessive charges or unnecessary services'\n            when '1128b7' then 'Fraud, kickbacks and other prohibited activities'\n            when '1128b8' then 'Entities controlled by a sanctioned individual'\n            when '1128b14' then 'Default on health education loan or scholarship obligations'\n            when '1128b15' then 'Individuals controlling a sanctioned entity'\n            when '1128b16' then 'Making false statements or misrepresentation of material facts'\n            else 'Other exclusion type'\n        end as EXCLUSION_REASON,\n\n        -- Dates\n        try_to_date(EXCLDATE, 'YYYYMMDD') as EXCLUSION_DATE,\n        try_to_date(REINDATE, 'YYYYMMDD') as REINSTATEMENT_DATE,\n        try_to_date(WAIVERDATE, 'YYYYMMDD') as WAIVER_DATE,\n        try_to_date(DOB, 'YYYYMMDD') as DATE_OF_BIRTH,\n\n        -- Waiver info\n        WVRSTATE as WAIVER_STATE,\n\n        -- Status\n        case\n            when REINDATE is not null and REINDATE != '' then false\n            else true\n        end as IS_CURRENTLY_EXCLUDED,\n\n        _LOAD_TIMESTAMP\n\n    from leie\n    where EXCLDATE is not null and EXCLDATE != ''\n),\n\nenriched as (\n    select\n        l.*,\n\n        -- NPPES enrichment\n        n.ENTITY_TYPE_DESC as NPPES_ENTITY_TYPE,\n        n.PROVIDER_FULL_NAME as NPPES_FULL_NAME,\n        n.ORGANIZATION_NAME_LBN as NPPES_ORGANIZATION,\n        n.PRIMARY_TAXONOMY_CODE as NPPES_TAXONOMY_CODE,\n        n.IS_ACTIVE as NPPES_IS_ACTIVE,\n        n.ENUMERATION_DATE as NPPES_ENUMERATION_DATE,\n\n        -- NPPES Address\n        a.CITY_NAME as NPPES_CITY,\n        a.STATE_CODE as NPPES_STATE,\n        a.POSTAL_CODE_5 as NPPES_ZIP,\n\n        -- Match quality\n        case\n            when l.NPI is not null and n.NPI is not null then 'NPI_MATCH'\n            when l.NPI is null then 'NO_NPI_IN_LEIE'\n            else 'NPI_NOT_FOUND_IN_NPPES'\n        end as MATCH_STATUS\n\n    from leie_cleaned l\n    left join nppes_provider n on l.NPI = n.NPI\n    left join nppes_address a on l.NPI = a.NPI\n),\n\nfinal as (\n    select\n        EXCLUSION_ID,\n        NPI,\n        UPIN,\n\n        -- Names\n        LAST_NAME,\n        FIRST_NAME,\n        MIDDLE_NAME,\n        BUSINESS_NAME,\n        NPPES_FULL_NAME,\n        NPPES_ORGANIZATION,\n\n        -- Provider info\n        PROVIDER_GENERAL_TYPE,\n        PROVIDER_SPECIALTY,\n        NPPES_ENTITY_TYPE,\n        NPPES_TAXONOMY_CODE,\n\n        -- LEIE Address\n        LEIE_ADDRESS as ADDRESS,\n        LEIE_CITY as CITY,\n        LEIE_STATE as STATE,\n        LEIE_ZIP as ZIP_CODE,\n\n        -- NPPES Address (for comparison)\n        NPPES_CITY,\n        NPPES_STATE,\n        NPPES_ZIP,\n\n        -- Exclusion details\n        EXCLUSION_TYPE_CODE,\n        EXCLUSION_REASON,\n        EXCLUSION_DATE,\n        REINSTATEMENT_DATE,\n        WAIVER_DATE,\n        WAIVER_STATE,\n        DATE_OF_BIRTH,\n\n        -- Status flags\n        IS_CURRENTLY_EXCLUDED,\n        NPPES_IS_ACTIVE,\n\n        -- Fraud risk: excluded but still active in NPPES\n        case\n            when IS_CURRENTLY_EXCLUDED = true and NPPES_IS_ACTIVE = true then true\n            else false\n        end as IS_HIGH_RISK,\n\n        -- Match quality\n        MATCH_STATUS,\n\n        -- Metadata\n        current_timestamp() as _loaded_at\n\n    from enriched\n    -- Deduplicate: keep one row per EXCLUSION_ID (most recent exclusion date)\n    qualify row_number() over (partition by EXCLUSION_ID order by EXCLUSION_DATE desc nulls last) = 1\n)\n\nselect * from final", "relation_name": "AI_FACTORY_DB.SILVER.excluded_providers", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.171221Z", "completed_at": "2026-02-06T20:36:03.176138Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.178793Z", "completed_at": "2026-02-06T20:36:03.178796Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.012246370315551758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.provider", "compiled": true, "compiled_code": "\n\n/*\n    Silver Provider Master\n    -----------------------\n    Combines NPPES provider data with address and taxonomy information.\n    This is the main provider reference table for fraud detection.\n*/\n\nwith nppes_provider as (\n    select * from AI_FACTORY_DB.STAGING.stg_nppes_provider\n),\n\nnppes_address as (\n    select * from AI_FACTORY_DB.STAGING.stg_nppes_provider_address\n    where IS_PRIMARY = true\n),\n\nnppes_taxonomy as (\n    select * from AI_FACTORY_DB.STAGING.stg_nppes_provider_taxonomy\n    where IS_PRIMARY_TAXONOMY = true\n),\n\nexcluded_providers as (\n    select distinct NPI\n    from AI_FACTORY_DB.STAGING.stg_leie\n    where NPI is not null and NPI != ''\n),\n\nprovider_with_address as (\n    select\n        p.NPI,\n        p.ENTITY_TYPE_CODE,\n        p.ENTITY_TYPE_DESC,\n        p.ORGANIZATION_NAME_LBN,\n        p.PROVIDER_LAST_NAME,\n        p.PROVIDER_FIRST_NAME,\n        p.PROVIDER_MIDDLE_NAME,\n        p.PROVIDER_FULL_NAME,\n        p.PROVIDER_CREDENTIAL,\n        p.PROVIDER_SEX_CODE,\n        p.PROVIDER_SEX_DESC,\n        p.IS_SOLE_PROPRIETOR,\n        p.PARENT_ORGANIZATION_LBN,\n        p.EIN,\n        p.PRIMARY_TAXONOMY_CODE,\n        p.ENUMERATION_DATE,\n        p.LAST_UPDATE_DATE,\n        p.IS_ACTIVE as IS_NPI_ACTIVE,\n\n        -- Address fields\n        a.ADDRESS_LINE_1,\n        a.ADDRESS_LINE_2,\n        a.CITY_NAME,\n        a.STATE_CODE,\n        a.POSTAL_CODE_5 as ZIP_CODE,\n        a.TELEPHONE_NUMBER,\n        a.FULL_ADDRESS\n\n    from nppes_provider p\n    left join nppes_address a on p.NPI = a.NPI\n),\n\nprovider_with_taxonomy as (\n    select\n        p.*,\n\n        -- Taxonomy fields\n        t.TAXONOMY_CODE,\n        t.TAXONOMY_CLASSIFICATION,\n        t.TAXONOMY_SPECIALIZATION,\n        t.PROVIDER_TYPE\n\n    from provider_with_address p\n    left join nppes_taxonomy t on p.NPI = t.NPI\n),\n\nfinal as (\n    select\n        -- Primary key\n        p.NPI,\n\n        -- Provider identification\n        p.ENTITY_TYPE_CODE,\n        p.ENTITY_TYPE_DESC,\n        case\n            when p.ENTITY_TYPE_CODE = '1' then 'Individual'\n            when p.ENTITY_TYPE_CODE = '2' then 'Organization'\n            else 'Unknown'\n        end as ENTITY_TYPE,\n\n        -- Name fields\n        p.ORGANIZATION_NAME_LBN as ORGANIZATION_NAME,\n        p.PROVIDER_LAST_NAME as LAST_NAME,\n        p.PROVIDER_FIRST_NAME as FIRST_NAME,\n        p.PROVIDER_MIDDLE_NAME as MIDDLE_NAME,\n        p.PROVIDER_FULL_NAME as FULL_NAME,\n        p.PROVIDER_CREDENTIAL as CREDENTIAL,\n\n        -- Demographics\n        p.PROVIDER_SEX_CODE as GENDER_CODE,\n        p.PROVIDER_SEX_DESC as GENDER,\n\n        -- Organization info\n        p.IS_SOLE_PROPRIETOR,\n        p.PARENT_ORGANIZATION_LBN as PARENT_ORGANIZATION,\n        p.EIN,\n\n        -- Address\n        p.ADDRESS_LINE_1,\n        p.ADDRESS_LINE_2,\n        p.CITY_NAME as CITY,\n        p.STATE_CODE as STATE,\n        p.ZIP_CODE,\n        p.TELEPHONE_NUMBER as PHONE,\n        p.FULL_ADDRESS,\n\n        -- Taxonomy/Specialty\n        p.PRIMARY_TAXONOMY_CODE,\n        p.TAXONOMY_CODE,\n        p.TAXONOMY_CLASSIFICATION as SPECIALTY_CLASSIFICATION,\n        p.TAXONOMY_SPECIALIZATION as SPECIALTY,\n        p.PROVIDER_TYPE,\n\n        -- Dates\n        p.ENUMERATION_DATE as NPI_ENUMERATION_DATE,\n        p.LAST_UPDATE_DATE as NPI_LAST_UPDATE_DATE,\n\n        -- Status flags\n        p.IS_NPI_ACTIVE,\n        case when e.NPI is not null then true else false end as IS_EXCLUDED,\n\n        -- Metadata\n        current_timestamp() as _loaded_at\n\n    from provider_with_taxonomy p\n    left join excluded_providers e on p.NPI = e.NPI\n    -- Deduplicate: keep one row per NPI (most recently updated)\n    qualify row_number() over (partition by p.NPI order by p.LAST_UPDATE_DATE desc nulls last) = 1\n)\n\nselect * from final", "relation_name": "AI_FACTORY_DB.SILVER.provider", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.174036Z", "completed_at": "2026-02-06T20:36:03.179353Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.180095Z", "completed_at": "2026-02-06T20:36:03.180098Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0070378780364990234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.facilities", "compiled": true, "compiled_code": "\n\n/*\n    Silver Facilities (Unified Healthcare Facilities)\n    ---------------------------------------------------\n    Consolidates Hospice, Home Health Care, Long-Term Care Hospitals,\n    and Nursing Home (Provider Information) into a single facilities table.\n*/\n\nwith hospice as (\n    select\n        'HOSPICE' as FACILITY_TYPE,\n        CMS_CERTIFICATION_NUMBER as CCN,\n        FACILITY_NAME as NAME,\n        ADDRESS_LINE_1 as ADDRESS_LINE_1,\n        ADDRESS_LINE_2 as ADDRESS_LINE_2,\n        CITY,\n        STATE,\n        ZIP_CODE,\n        COUNTY_NAME as COUNTY,\n        PHONE_NUMBER as PHONE,\n        CMS_REGION,\n        OWNERSHIP_TYPE,\n        try_to_date(CERTIFICATION_DATE, 'YYYY-MM-DD') as CERTIFICATION_DATE,\n        null as OVERALL_RATING,\n        null as HEALTH_INSPECTION_RATING,\n        null as STAFFING_RATING,\n        null as NUMBER_OF_BEDS,\n        null as NUMBER_OF_RESIDENTS,\n        _LOAD_TIMESTAMP\n    from AI_FACTORY_DB.STAGING.stg_hospice\n    where CMS_CERTIFICATION_NUMBER is not null\n),\n\nhome_health as (\n    select\n        'HOME_HEALTH' as FACILITY_TYPE,\n        CMS_CERTIFICATION_NUMBER as CCN,\n        PROVIDER_NAME as NAME,\n        ADDRESS as ADDRESS_LINE_1,\n        null as ADDRESS_LINE_2,\n        CITY,\n        STATE,\n        ZIP_CODE,\n        null as COUNTY,\n        PHONE,\n        null as CMS_REGION,\n        TYPE_OF_OWNERSHIP as OWNERSHIP_TYPE,\n        try_to_date(DATE_CERTIFIED, 'YYYY-MM-DD') as CERTIFICATION_DATE,\n        null as OVERALL_RATING,\n        null as HEALTH_INSPECTION_RATING,\n        null as STAFFING_RATING,\n        null as NUMBER_OF_BEDS,\n        null as NUMBER_OF_RESIDENTS,\n        _LOAD_TIMESTAMP\n    from AI_FACTORY_DB.STAGING.stg_home_health_care\n    where CMS_CERTIFICATION_NUMBER is not null\n),\n\nltch as (\n    select\n        'LTCH' as FACILITY_TYPE,\n        CMS_CERTIFICATION_NUMBER as CCN,\n        FACILITY_NAME as NAME,\n        ADDRESS as ADDRESS_LINE_1,\n        null as ADDRESS_LINE_2,\n        CITY,\n        STATE,\n        ZIP_CODE,\n        COUNTY_NAME as COUNTY,\n        PHONE_NUMBER as PHONE,\n        CMS_REGION,\n        null as OWNERSHIP_TYPE,\n        null as CERTIFICATION_DATE,\n        null as OVERALL_RATING,\n        null as HEALTH_INSPECTION_RATING,\n        null as STAFFING_RATING,\n        null as NUMBER_OF_BEDS,\n        null as NUMBER_OF_RESIDENTS,\n        _LOAD_TIMESTAMP\n    from AI_FACTORY_DB.STAGING.stg_longterm_care_hospital\n    where CMS_CERTIFICATION_NUMBER is not null\n),\n\nnursing_home as (\n    select\n        'NURSING_HOME' as FACILITY_TYPE,\n        FEDERAL_PROVIDER_NUMBER as CCN,\n        PROVIDER_NAME as NAME,\n        PROVIDER_ADDRESS as ADDRESS_LINE_1,\n        null as ADDRESS_LINE_2,\n        PROVIDER_CITY as CITY,\n        PROVIDER_STATE as STATE,\n        PROVIDER_ZIP_CODE as ZIP_CODE,\n        PROVIDER_COUNTY_NAME as COUNTY,\n        PROVIDER_PHONE_NUMBER as PHONE,\n        null as CMS_REGION,\n        OWNERSHIP_TYPE,\n        try_to_date(DATE_FIRST_APPROVED, 'YYYY-MM-DD') as CERTIFICATION_DATE,\n        try_to_number(OVERALL_RATING) as OVERALL_RATING,\n        try_to_number(HEALTH_INSPECTION_RATING) as HEALTH_INSPECTION_RATING,\n        try_to_number(STAFFING_RATING) as STAFFING_RATING,\n        try_to_number(NUMBER_OF_CERTIFIED_BEDS) as NUMBER_OF_BEDS,\n        try_to_number(NUMBER_OF_RESIDENTS) as NUMBER_OF_RESIDENTS,\n        _LOAD_TIMESTAMP\n    from AI_FACTORY_DB.STAGING.stg_provider_information\n    where FEDERAL_PROVIDER_NUMBER is not null\n),\n\nall_facilities as (\n    select * from hospice\n    union all\n    select * from home_health\n    union all\n    select * from ltch\n    union all\n    select * from nursing_home\n),\n\ndeduplicated as (\n    select\n        *,\n        row_number() over (\n            partition by CCN\n            order by _LOAD_TIMESTAMP desc\n        ) as rn\n    from all_facilities\n),\n\nfinal as (\n    select\n        -- Generate unique facility ID\n        md5(cast(coalesce(cast(FACILITY_TYPE as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(CCN as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as FACILITY_ID,\n\n        -- Facility identification\n        CCN,\n        NAME as FACILITY_NAME,\n        FACILITY_TYPE,\n\n        -- Address\n        ADDRESS_LINE_1,\n        ADDRESS_LINE_2,\n        CITY,\n        STATE,\n        ZIP_CODE,\n        COUNTY,\n        concat_ws(', ', ADDRESS_LINE_1, CITY, STATE, ZIP_CODE) as FULL_ADDRESS,\n\n        -- Contact\n        PHONE,\n        CMS_REGION,\n\n        -- Organization\n        OWNERSHIP_TYPE,\n        case\n            when OWNERSHIP_TYPE ilike '%profit%' and OWNERSHIP_TYPE not ilike '%non%' then 'FOR_PROFIT'\n            when OWNERSHIP_TYPE ilike '%non%profit%' or OWNERSHIP_TYPE ilike '%not%profit%' then 'NON_PROFIT'\n            when OWNERSHIP_TYPE ilike '%government%' or OWNERSHIP_TYPE ilike '%state%' or OWNERSHIP_TYPE ilike '%county%' then 'GOVERNMENT'\n            else 'OTHER'\n        end as OWNERSHIP_CATEGORY,\n\n        -- Dates\n        CERTIFICATION_DATE,\n\n        -- Quality metrics (nursing homes only)\n        OVERALL_RATING,\n        HEALTH_INSPECTION_RATING,\n        STAFFING_RATING,\n\n        -- Capacity (nursing homes only)\n        NUMBER_OF_BEDS,\n        NUMBER_OF_RESIDENTS,\n        case\n            when NUMBER_OF_BEDS > 0 then round(NUMBER_OF_RESIDENTS / NUMBER_OF_BEDS * 100, 1)\n            else null\n        end as OCCUPANCY_RATE,\n\n        -- Risk indicators\n        case\n            when OVERALL_RATING = 1 then true\n            else false\n        end as IS_LOW_QUALITY,\n\n        -- Metadata\n        current_timestamp() as _loaded_at\n\n    from deduplicated\n    where rn = 1\n)\n\nselect * from final", "relation_name": "AI_FACTORY_DB.SILVER.facilities", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.176612Z", "completed_at": "2026-02-06T20:36:03.180348Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.186502Z", "completed_at": "2026-02-06T20:36:03.186506Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.015553951263427734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.payments", "compiled": true, "compiled_code": "\n\n/*\n    Silver Payments (Open Payments Consolidated)\n    ---------------------------------------------\n    Consolidates General, Research, and Ownership payments into a single table.\n    Key table for detecting pharmaceutical influence patterns.\n\n    Note: Open Payments columns are case-sensitive (created via INFER_SCHEMA)\n*/\n\nwith general_payments as (\n    select\n        'GENERAL' as PAYMENT_CATEGORY,\n        \"Record_ID\" as RECORD_ID,\n        \"Covered_Recipient_NPI\" as NPI,\n        \"Covered_Recipient_Type\" as RECIPIENT_TYPE,\n        \"Covered_Recipient_First_Name\" as FIRST_NAME,\n        \"Covered_Recipient_Last_Name\" as LAST_NAME,\n        \"Covered_Recipient_Specialty_1\" as SPECIALTY,\n        \"Recipient_City\" as CITY,\n        \"Recipient_State\" as STATE,\n        \"Recipient_Zip_Code\" as ZIP_CODE,\n        \"Teaching_Hospital_Name\" as TEACHING_HOSPITAL,\n        \"Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_Name\" as PAYER_NAME,\n        try_to_number(\"Total_Amount_of_Payment_USDollars\", 18, 2) as PAYMENT_AMOUNT,\n        try_to_date(\"Date_of_Payment\", 'MM/DD/YYYY') as PAYMENT_DATE,\n        \"Form_of_Payment_or_Transfer_of_Value\" as PAYMENT_FORM,\n        \"Nature_of_Payment_or_Transfer_of_Value\" as PAYMENT_NATURE,\n        \"Program_Year\" as PROGRAM_YEAR,\n        null as STUDY_NAME,\n        null as CLINICAL_TRIAL_ID,\n        null as INVESTMENT_AMOUNT,\n        null as INTEREST_VALUE\n    from AI_FACTORY_DB.STAGING.stg_open_payments_general\n    where \"Record_ID\" is not null\n),\n\nresearch_payments as (\n    select\n        'RESEARCH' as PAYMENT_CATEGORY,\n        \"Record_ID\" as RECORD_ID,\n        \"Covered_Recipient_NPI\" as NPI,\n        \"Covered_Recipient_Type\" as RECIPIENT_TYPE,\n        \"Covered_Recipient_First_Name\" as FIRST_NAME,\n        \"Covered_Recipient_Last_Name\" as LAST_NAME,\n        \"Covered_Recipient_Specialty_1\" as SPECIALTY,\n        \"Recipient_City\" as CITY,\n        \"Recipient_State\" as STATE,\n        \"Recipient_Zip_Code\" as ZIP_CODE,\n        \"Teaching_Hospital_Name\" as TEACHING_HOSPITAL,\n        \"Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_Name\" as PAYER_NAME,\n        try_to_number(\"Total_Amount_of_Payment_USDollars\", 18, 2) as PAYMENT_AMOUNT,\n        try_to_date(\"Date_of_Payment\", 'MM/DD/YYYY') as PAYMENT_DATE,\n        \"Form_of_Payment_or_Transfer_of_Value\" as PAYMENT_FORM,\n        null as PAYMENT_NATURE,\n        \"Program_Year\" as PROGRAM_YEAR,\n        \"Name_of_Study\" as STUDY_NAME,\n        \"ClinicalTrials_Gov_Identifier\" as CLINICAL_TRIAL_ID,\n        null as INVESTMENT_AMOUNT,\n        null as INTEREST_VALUE\n    from AI_FACTORY_DB.STAGING.stg_open_payments_research\n    where \"Record_ID\" is not null\n),\n\nownership_payments as (\n    select\n        'OWNERSHIP' as PAYMENT_CATEGORY,\n        \"Record_ID\" as RECORD_ID,\n        \"Physician_NPI\" as NPI,\n        'Physician' as RECIPIENT_TYPE,\n        \"Physician_First_Name\" as FIRST_NAME,\n        \"Physician_Last_Name\" as LAST_NAME,\n        \"Physician_Specialty\" as SPECIALTY,\n        \"Recipient_City\" as CITY,\n        \"Recipient_State\" as STATE,\n        \"Recipient_Zip_Code\" as ZIP_CODE,\n        null as TEACHING_HOSPITAL,\n        \"Applicable_Manufacturer_or_Applicable_GPO_Making_Payment_Name\" as PAYER_NAME,\n        null as PAYMENT_AMOUNT,\n        null as PAYMENT_DATE,\n        null as PAYMENT_FORM,\n        null as PAYMENT_NATURE,\n        \"Program_Year\" as PROGRAM_YEAR,\n        null as STUDY_NAME,\n        null as CLINICAL_TRIAL_ID,\n        try_to_number(\"Total_Amount_Invested_USDollars\", 18, 2) as INVESTMENT_AMOUNT,\n        \"Value_of_Interest\" as INTEREST_VALUE\n    from AI_FACTORY_DB.STAGING.stg_open_payments_ownership\n    where \"Record_ID\" is not null\n),\n\nall_payments as (\n    select * from general_payments\n    union all\n    select * from research_payments\n    union all\n    select * from ownership_payments\n),\n\nexcluded_npis as (\n    select distinct NPI\n    from AI_FACTORY_DB.STAGING.stg_leie\n    where NPI is not null and NPI != ''\n),\n\nfinal as (\n    select\n        -- Generate unique payment ID\n        md5(cast(coalesce(cast(PAYMENT_CATEGORY as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(RECORD_ID as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as PAYMENT_ID,\n\n        -- Payment classification\n        p.PAYMENT_CATEGORY,\n        p.RECORD_ID,\n\n        -- Recipient info\n        p.NPI,\n        p.RECIPIENT_TYPE,\n        p.FIRST_NAME,\n        p.LAST_NAME,\n        concat_ws(' ', p.FIRST_NAME, p.LAST_NAME) as FULL_NAME,\n        p.SPECIALTY,\n\n        -- Location\n        p.CITY,\n        p.STATE,\n        p.ZIP_CODE,\n        p.TEACHING_HOSPITAL,\n\n        -- Payer info\n        p.PAYER_NAME,\n\n        -- Payment details\n        p.PAYMENT_AMOUNT,\n        p.PAYMENT_DATE,\n        p.PAYMENT_FORM,\n        p.PAYMENT_NATURE,\n        extract(year from p.PAYMENT_DATE) as PAYMENT_YEAR,\n        extract(month from p.PAYMENT_DATE) as PAYMENT_MONTH,\n\n        -- Research specific\n        p.STUDY_NAME,\n        p.CLINICAL_TRIAL_ID,\n\n        -- Ownership specific\n        p.INVESTMENT_AMOUNT,\n        p.INTEREST_VALUE,\n\n        -- Program info\n        try_to_number(p.PROGRAM_YEAR) as PROGRAM_YEAR,\n\n        -- Fraud detection flags\n        case when e.NPI is not null then true else false end as IS_RECIPIENT_EXCLUDED,\n\n        -- Payment risk tiers\n        case\n            when p.PAYMENT_AMOUNT >= 100000 then 'VERY_HIGH'\n            when p.PAYMENT_AMOUNT >= 10000 then 'HIGH'\n            when p.PAYMENT_AMOUNT >= 1000 then 'MEDIUM'\n            when p.PAYMENT_AMOUNT >= 100 then 'LOW'\n            else 'MINIMAL'\n        end as PAYMENT_RISK_TIER,\n\n        -- Metadata\n        current_timestamp() as _loaded_at\n\n    from all_payments p\n    left join excluded_npis e on p.NPI = e.NPI\n)\n\nselect * from final", "relation_name": "AI_FACTORY_DB.SILVER.payments", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.180738Z", "completed_at": "2026-02-06T20:36:03.190989Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.191710Z", "completed_at": "2026-02-06T20:36:03.191714Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.012670755386352539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.accepted_values_hospital_spending_SPENDING_RISK_TIER__HIGH__MEDIUM__LOW__NORMAL.dfb203ec0c", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        SPENDING_RISK_TIER as value_field,\n        count(*) as n_records\n\n    from AI_FACTORY_DB.SILVER.hospital_spending\n    group by SPENDING_RISK_TIER\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'HIGH','MEDIUM','LOW','NORMAL'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.187558Z", "completed_at": "2026-02-06T20:36:03.193803Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.195876Z", "completed_at": "2026-02-06T20:36:03.195880Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.01537775993347168, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_hospital_spending_CCN.06ad4353f0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect CCN\nfrom AI_FACTORY_DB.SILVER.hospital_spending\nwhere CCN is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.192007Z", "completed_at": "2026-02-06T20:36:03.196370Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.196999Z", "completed_at": "2026-02-06T20:36:03.197003Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009968280792236328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_hospital_spending_IS_HIGH_SPENDER.c66e3ae0af", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect IS_HIGH_SPENDER\nfrom AI_FACTORY_DB.SILVER.hospital_spending\nwhere IS_HIGH_SPENDER is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.194285Z", "completed_at": "2026-02-06T20:36:03.197260Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.201362Z", "completed_at": "2026-02-06T20:36:03.201367Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009961605072021484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_hospital_spending_SPENDING_ID.7ace77775f", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect SPENDING_ID\nfrom AI_FACTORY_DB.SILVER.hospital_spending\nwhere SPENDING_ID is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.197649Z", "completed_at": "2026-02-06T20:36:03.202726Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.206957Z", "completed_at": "2026-02-06T20:36:03.206961Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010827064514160156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.unique_hospital_spending_SPENDING_ID.83042b3379", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    SPENDING_ID as unique_field,\n    count(*) as n_records\n\nfrom AI_FACTORY_DB.SILVER.hospital_spending\nwhere SPENDING_ID is not null\ngroup by SPENDING_ID\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.203090Z", "completed_at": "2026-02-06T20:36:03.209238Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.209886Z", "completed_at": "2026-02-06T20:36:03.209889Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.012458562850952148, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.prescriptions_summary", "compiled": true, "compiled_code": "\n\n/*\n    Gold Prescriptions Summary\n    --------------------------\n    Aggregated prescription metrics by provider.\n    Key indicators for prescribing pattern analysis.\n*/\n\nwith prescriptions as (\n    select * from AI_FACTORY_DB.SILVER.prescriptions\n),\n\nprovider_prescriptions as (\n    select\n        NPI,\n        MAX(PRESCRIBER_FULL_NAME) as PRESCRIBER_NAME,\n        MAX(PRESCRIBER_TYPE) as SPECIALTY,\n        MAX(STATE) as STATE,\n\n        -- Volume metrics\n        COUNT(*) as TOTAL_DRUG_RECORDS,\n        SUM(TOTAL_CLAIMS) as TOTAL_CLAIMS,\n        SUM(TOTAL_BENEFICIARIES) as TOTAL_BENEFICIARIES,\n        SUM(TOTAL_30DAY_FILLS) as TOTAL_30_DAY_FILLS,\n\n        -- Cost metrics\n        SUM(TOTAL_DRUG_COST) as TOTAL_COST,\n        ROUND(AVG(AVG_COST_PER_CLAIM), 2) as AVG_COST_PER_CLAIM,\n\n        -- Unique drugs prescribed\n        COUNT(DISTINCT GENERIC_NAME) as UNIQUE_DRUGS_PRESCRIBED,\n\n        -- Brand vs Generic\n        SUM(case when DRUG_TYPE = 'BRAND' then TOTAL_CLAIMS else 0 end) as BRAND_CLAIMS,\n        SUM(case when DRUG_TYPE = 'BRAND' then TOTAL_DRUG_COST else 0 end) as BRAND_COST,\n\n        -- Risk distribution\n        COUNT(case when RISK_TIER = 'CRITICAL' then 1 end) as CRITICAL_RISK_DRUGS,\n        COUNT(case when RISK_TIER = 'VERY_HIGH' then 1 end) as VERY_HIGH_RISK_DRUGS,\n        COUNT(case when RISK_TIER = 'HIGH' then 1 end) as HIGH_RISK_DRUGS,\n\n        -- Exclusion flag\n        MAX(case when IS_PRESCRIBER_EXCLUDED then 1 else 0 end) as IS_EXCLUDED\n\n    from prescriptions\n    group by NPI\n),\n\nfinal as (\n    select\n        md5(cast(coalesce(cast(NPI as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as PROVIDER_PRESCRIPTION_KEY,\n        NPI,\n        PRESCRIBER_NAME,\n        SPECIALTY,\n        STATE,\n\n        -- Volume\n        TOTAL_DRUG_RECORDS,\n        TOTAL_CLAIMS,\n        TOTAL_BENEFICIARIES,\n        TOTAL_30_DAY_FILLS,\n\n        -- Cost\n        TOTAL_COST,\n        AVG_COST_PER_CLAIM,\n        case when TOTAL_CLAIMS > 0 then ROUND(TOTAL_COST / TOTAL_CLAIMS, 2) else 0 end as COST_PER_CLAIM,\n\n        -- Drug diversity\n        UNIQUE_DRUGS_PRESCRIBED,\n\n        -- Brand preference\n        BRAND_CLAIMS,\n        BRAND_COST,\n        case when TOTAL_CLAIMS > 0 then ROUND(BRAND_CLAIMS * 100.0 / TOTAL_CLAIMS, 2) else 0 end as PCT_BRAND_CLAIMS,\n        case when TOTAL_COST > 0 then ROUND(BRAND_COST * 100.0 / TOTAL_COST, 2) else 0 end as PCT_BRAND_COST,\n\n        -- Risk drugs count\n        CRITICAL_RISK_DRUGS,\n        VERY_HIGH_RISK_DRUGS,\n        HIGH_RISK_DRUGS,\n        CRITICAL_RISK_DRUGS + VERY_HIGH_RISK_DRUGS + HIGH_RISK_DRUGS as TOTAL_HIGH_RISK_DRUGS,\n\n        -- Flags\n        case when IS_EXCLUDED = 1 then true else false end as IS_EXCLUDED_PROVIDER,\n\n        -- Prescriber tier (based on volume)\n        case\n            when TOTAL_CLAIMS >= 100000 then 'VERY_HIGH_VOLUME'\n            when TOTAL_CLAIMS >= 10000 then 'HIGH_VOLUME'\n            when TOTAL_CLAIMS >= 1000 then 'MEDIUM_VOLUME'\n            else 'LOW_VOLUME'\n        end as PRESCRIBER_VOLUME_TIER,\n\n        current_timestamp() as _loaded_at\n\n    from provider_prescriptions\n)\n\nselect * from final", "relation_name": "AI_FACTORY_DB.GOLD.prescriptions_summary", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.207238Z", "completed_at": "2026-02-06T20:36:03.210127Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.211003Z", "completed_at": "2026-02-06T20:36:03.211006Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008704900741577148, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_prescriptions_IS_PRESCRIBER_EXCLUDED.aabfede193", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect IS_PRESCRIBER_EXCLUDED\nfrom AI_FACTORY_DB.SILVER.prescriptions\nwhere IS_PRESCRIBER_EXCLUDED is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.204765Z", "completed_at": "2026-02-06T20:36:03.209467Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.210322Z", "completed_at": "2026-02-06T20:36:03.210326Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008417367935180664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.accepted_values_prescriptions_RISK_TIER__CRITICAL__VERY_HIGH__HIGH__MEDIUM__LOW.686ae60428", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        RISK_TIER as value_field,\n        count(*) as n_records\n\n    from AI_FACTORY_DB.SILVER.prescriptions\n    group by RISK_TIER\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'CRITICAL','VERY_HIGH','HIGH','MEDIUM','LOW'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.211439Z", "completed_at": "2026-02-06T20:36:03.214306Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.217785Z", "completed_at": "2026-02-06T20:36:03.217789Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008156776428222656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_prescriptions_NPI.a370598ce2", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect NPI\nfrom AI_FACTORY_DB.SILVER.prescriptions\nwhere NPI is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.214468Z", "completed_at": "2026-02-06T20:36:03.220055Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.220626Z", "completed_at": "2026-02-06T20:36:03.220629Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0076160430908203125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_prescriptions_PRESCRIPTION_ID.7898c81ca3", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect PRESCRIPTION_ID\nfrom AI_FACTORY_DB.SILVER.prescriptions\nwhere PRESCRIPTION_ID is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.216271Z", "completed_at": "2026-02-06T20:36:03.220904Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.221637Z", "completed_at": "2026-02-06T20:36:03.221641Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008182048797607422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.unique_prescriptions_PRESCRIPTION_ID.e8b62e3a80", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    PRESCRIPTION_ID as unique_field,\n    count(*) as n_records\n\nfrom AI_FACTORY_DB.SILVER.prescriptions\nwhere PRESCRIPTION_ID is not null\ngroup by PRESCRIPTION_ID\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.218151Z", "completed_at": "2026-02-06T20:36:03.221222Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.224355Z", "completed_at": "2026-02-06T20:36:03.224358Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.01045370101928711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_excluded_providers_EXCLUSION_DATE.7843ec0824", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect EXCLUSION_DATE\nfrom AI_FACTORY_DB.SILVER.excluded_providers\nwhere EXCLUSION_DATE is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.221906Z", "completed_at": "2026-02-06T20:36:03.225863Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.227938Z", "completed_at": "2026-02-06T20:36:03.227941Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007636308670043945, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_excluded_providers_EXCLUSION_ID.ddc326ce77", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect EXCLUSION_ID\nfrom AI_FACTORY_DB.SILVER.excluded_providers\nwhere EXCLUSION_ID is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.226215Z", "completed_at": "2026-02-06T20:36:03.231869Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.232379Z", "completed_at": "2026-02-06T20:36:03.232424Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.007831335067749023, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_excluded_providers_IS_CURRENTLY_EXCLUDED.3839ab8cb2", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect IS_CURRENTLY_EXCLUDED\nfrom AI_FACTORY_DB.SILVER.excluded_providers\nwhere IS_CURRENTLY_EXCLUDED is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.228457Z", "completed_at": "2026-02-06T20:36:03.232679Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.233411Z", "completed_at": "2026-02-06T20:36:03.233414Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007779121398925781, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_excluded_providers_IS_HIGH_RISK.31e100bea7", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect IS_HIGH_RISK\nfrom AI_FACTORY_DB.SILVER.excluded_providers\nwhere IS_HIGH_RISK is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.230207Z", "completed_at": "2026-02-06T20:36:03.233194Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.236233Z", "completed_at": "2026-02-06T20:36:03.236236Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010236501693725586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.unique_excluded_providers_EXCLUSION_ID.7a7200758a", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    EXCLUSION_ID as unique_field,\n    count(*) as n_records\n\nfrom AI_FACTORY_DB.SILVER.excluded_providers\nwhere EXCLUSION_ID is not null\ngroup by EXCLUSION_ID\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.233686Z", "completed_at": "2026-02-06T20:36:03.237626Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.239818Z", "completed_at": "2026-02-06T20:36:03.239821Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0077626705169677734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.accepted_values_provider_ENTITY_TYPE__Individual__Organization__Unknown.b904f06ae1", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        ENTITY_TYPE as value_field,\n        count(*) as n_records\n\n    from AI_FACTORY_DB.SILVER.provider\n    group by ENTITY_TYPE\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'Individual','Organization','Unknown'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.237787Z", "completed_at": "2026-02-06T20:36:03.242082Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.244039Z", "completed_at": "2026-02-06T20:36:03.244043Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.008052825927734375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_provider_IS_EXCLUDED.fadec3507b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect IS_EXCLUDED\nfrom AI_FACTORY_DB.SILVER.provider\nwhere IS_EXCLUDED is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.240351Z", "completed_at": "2026-02-06T20:36:03.244556Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.247459Z", "completed_at": "2026-02-06T20:36:03.247462Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010077238082885742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_provider_NPI.5274731a26", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect NPI\nfrom AI_FACTORY_DB.SILVER.provider\nwhere NPI is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.242240Z", "completed_at": "2026-02-06T20:36:03.247704Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.248395Z", "completed_at": "2026-02-06T20:36:03.248398Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009002208709716797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.unique_provider_NPI.1d404b048d", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    NPI as unique_field,\n    count(*) as n_records\n\nfrom AI_FACTORY_DB.SILVER.provider\nwhere NPI is not null\ngroup by NPI\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.244951Z", "completed_at": "2026-02-06T20:36:03.248653Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.249447Z", "completed_at": "2026-02-06T20:36:03.249451Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005650520324707031, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.accepted_values_facilities_FACILITY_TYPE__HOSPICE__HOME_HEALTH__LTCH__NURSING_HOME.5d02afee23", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        FACILITY_TYPE as value_field,\n        count(*) as n_records\n\n    from AI_FACTORY_DB.SILVER.facilities\n    group by FACILITY_TYPE\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'HOSPICE','HOME_HEALTH','LTCH','NURSING_HOME'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.249904Z", "completed_at": "2026-02-06T20:36:03.255851Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.257913Z", "completed_at": "2026-02-06T20:36:03.257917Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.009826421737670898, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.accepted_values_facilities_OWNERSHIP_CATEGORY__FOR_PROFIT__NON_PROFIT__GOVERNMENT__OTHER.2d88da120a", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        OWNERSHIP_CATEGORY as value_field,\n        count(*) as n_records\n\n    from AI_FACTORY_DB.SILVER.facilities\n    group by OWNERSHIP_CATEGORY\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'FOR_PROFIT','NON_PROFIT','GOVERNMENT','OTHER'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.253775Z", "completed_at": "2026-02-06T20:36:03.257758Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.259891Z", "completed_at": "2026-02-06T20:36:03.259894Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.011078834533691406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_facilities_CCN.006ac78131", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect CCN\nfrom AI_FACTORY_DB.SILVER.facilities\nwhere CCN is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.256022Z", "completed_at": "2026-02-06T20:36:03.260657Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.261275Z", "completed_at": "2026-02-06T20:36:03.261278Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007923126220703125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_facilities_FACILITY_ID.35526b817b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect FACILITY_ID\nfrom AI_FACTORY_DB.SILVER.facilities\nwhere FACILITY_ID is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.258244Z", "completed_at": "2026-02-06T20:36:03.261529Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.262289Z", "completed_at": "2026-02-06T20:36:03.262292Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0067250728607177734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_facilities_FACILITY_TYPE.ed5410a522", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect FACILITY_TYPE\nfrom AI_FACTORY_DB.SILVER.facilities\nwhere FACILITY_TYPE is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.262574Z", "completed_at": "2026-02-06T20:36:03.266798Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.269796Z", "completed_at": "2026-02-06T20:36:03.269799Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.008972644805908203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.unique_facilities_FACILITY_ID.de2e3893a7", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    FACILITY_ID as unique_field,\n    count(*) as n_records\n\nfrom AI_FACTORY_DB.SILVER.facilities\nwhere FACILITY_ID is not null\ngroup by FACILITY_ID\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.264177Z", "completed_at": "2026-02-06T20:36:03.269458Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.270122Z", "completed_at": "2026-02-06T20:36:03.270126Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009098291397094727, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.payments_summary", "compiled": true, "compiled_code": "\n\n/*\n    Gold Payments Summary\n    ---------------------\n    Aggregated payment metrics by provider.\n    Shows total pharma payments received and patterns.\n*/\n\nwith payments as (\n    select * from AI_FACTORY_DB.SILVER.payments\n    where NPI is not null\n),\n\nprovider_payments as (\n    select\n        NPI,\n\n        -- Payment counts by category\n        COUNT(*) as TOTAL_PAYMENTS,\n        COUNT(case when PAYMENT_CATEGORY = 'GENERAL' then 1 end) as GENERAL_PAYMENTS,\n        COUNT(case when PAYMENT_CATEGORY = 'RESEARCH' then 1 end) as RESEARCH_PAYMENTS,\n        COUNT(case when PAYMENT_CATEGORY = 'OWNERSHIP' then 1 end) as OWNERSHIP_PAYMENTS,\n\n        -- Payment amounts\n        COALESCE(SUM(PAYMENT_AMOUNT), 0) as TOTAL_PAYMENT_AMOUNT,\n        COALESCE(SUM(case when PAYMENT_CATEGORY = 'GENERAL' then PAYMENT_AMOUNT end), 0) as GENERAL_PAYMENT_AMOUNT,\n        COALESCE(SUM(case when PAYMENT_CATEGORY = 'RESEARCH' then PAYMENT_AMOUNT end), 0) as RESEARCH_PAYMENT_AMOUNT,\n        COALESCE(SUM(INVESTMENT_AMOUNT), 0) as TOTAL_INVESTMENT_AMOUNT,\n\n        -- Average payment\n        ROUND(AVG(PAYMENT_AMOUNT), 2) as AVG_PAYMENT_AMOUNT,\n        MAX(PAYMENT_AMOUNT) as MAX_PAYMENT_AMOUNT,\n\n        -- Unique payers\n        COUNT(DISTINCT PAYER_NAME) as UNIQUE_PAYERS,\n\n        -- Payment risk distribution\n        COUNT(case when PAYMENT_RISK_TIER = 'VERY_HIGH' then 1 end) as VERY_HIGH_RISK_PAYMENTS,\n        COUNT(case when PAYMENT_RISK_TIER = 'HIGH' then 1 end) as HIGH_RISK_PAYMENTS,\n\n        -- Time range\n        MIN(PAYMENT_DATE) as FIRST_PAYMENT_DATE,\n        MAX(PAYMENT_DATE) as LAST_PAYMENT_DATE,\n        COUNT(DISTINCT PAYMENT_YEAR) as YEARS_WITH_PAYMENTS,\n\n        -- Exclusion flag (any payment to excluded provider)\n        MAX(case when IS_RECIPIENT_EXCLUDED then 1 else 0 end) as HAS_EXCLUDED_RECIPIENT\n\n    from payments\n    group by NPI\n),\n\nfinal as (\n    select\n        md5(cast(coalesce(cast(NPI as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as PROVIDER_PAYMENT_KEY,\n        NPI,\n\n        -- Counts\n        TOTAL_PAYMENTS,\n        GENERAL_PAYMENTS,\n        RESEARCH_PAYMENTS,\n        OWNERSHIP_PAYMENTS,\n\n        -- Amounts\n        TOTAL_PAYMENT_AMOUNT,\n        GENERAL_PAYMENT_AMOUNT,\n        RESEARCH_PAYMENT_AMOUNT,\n        TOTAL_INVESTMENT_AMOUNT,\n        AVG_PAYMENT_AMOUNT,\n        MAX_PAYMENT_AMOUNT,\n\n        -- Payers\n        UNIQUE_PAYERS,\n\n        -- Risk metrics\n        VERY_HIGH_RISK_PAYMENTS,\n        HIGH_RISK_PAYMENTS,\n        VERY_HIGH_RISK_PAYMENTS + HIGH_RISK_PAYMENTS as TOTAL_HIGH_RISK_PAYMENTS,\n\n        -- Payment concentration (% from high risk payments)\n        case\n            when TOTAL_PAYMENTS > 0\n            then ROUND((VERY_HIGH_RISK_PAYMENTS + HIGH_RISK_PAYMENTS) * 100.0 / TOTAL_PAYMENTS, 2)\n            else 0\n        end as PCT_HIGH_RISK_PAYMENTS,\n\n        -- Time analysis\n        FIRST_PAYMENT_DATE,\n        LAST_PAYMENT_DATE,\n        YEARS_WITH_PAYMENTS,\n\n        -- Flags\n        case when HAS_EXCLUDED_RECIPIENT = 1 then true else false end as IS_EXCLUDED_PROVIDER,\n\n        -- Payment tier\n        case\n            when TOTAL_PAYMENT_AMOUNT >= 1000000 then 'MEGA_RECIPIENT'\n            when TOTAL_PAYMENT_AMOUNT >= 100000 then 'MAJOR_RECIPIENT'\n            when TOTAL_PAYMENT_AMOUNT >= 10000 then 'SIGNIFICANT_RECIPIENT'\n            when TOTAL_PAYMENT_AMOUNT >= 1000 then 'MODERATE_RECIPIENT'\n            else 'MINOR_RECIPIENT'\n        end as RECIPIENT_TIER,\n\n        current_timestamp() as _loaded_at\n\n    from provider_payments\n)\n\nselect * from final", "relation_name": "AI_FACTORY_DB.GOLD.payments_summary", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.266986Z", "completed_at": "2026-02-06T20:36:03.272500Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.273266Z", "completed_at": "2026-02-06T20:36:03.273269Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0074617862701416016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.accepted_values_payments_PAYMENT_CATEGORY__GENERAL__RESEARCH__OWNERSHIP.ba2f74c8af", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        PAYMENT_CATEGORY as value_field,\n        count(*) as n_records\n\n    from AI_FACTORY_DB.SILVER.payments\n    group by PAYMENT_CATEGORY\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'GENERAL','RESEARCH','OWNERSHIP'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.270436Z", "completed_at": "2026-02-06T20:36:03.273740Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.274521Z", "completed_at": "2026-02-06T20:36:03.274525Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007967233657836914, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.accepted_values_payments_PAYMENT_RISK_TIER__VERY_HIGH__HIGH__MEDIUM__LOW__MINIMAL.3c805fd3a5", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        PAYMENT_RISK_TIER as value_field,\n        count(*) as n_records\n\n    from AI_FACTORY_DB.SILVER.payments\n    group by PAYMENT_RISK_TIER\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'VERY_HIGH','HIGH','MEDIUM','LOW','MINIMAL'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.274784Z", "completed_at": "2026-02-06T20:36:03.279501Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.281405Z", "completed_at": "2026-02-06T20:36:03.281408Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.00839686393737793, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_payments_IS_RECIPIENT_EXCLUDED.9c4825b438", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect IS_RECIPIENT_EXCLUDED\nfrom AI_FACTORY_DB.SILVER.payments\nwhere IS_RECIPIENT_EXCLUDED is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.276550Z", "completed_at": "2026-02-06T20:36:03.281645Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.282248Z", "completed_at": "2026-02-06T20:36:03.282251Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008710861206054688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_payments_PAYMENT_CATEGORY.6649392d23", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect PAYMENT_CATEGORY\nfrom AI_FACTORY_DB.SILVER.payments\nwhere PAYMENT_CATEGORY is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.279854Z", "completed_at": "2026-02-06T20:36:03.284480Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.284998Z", "completed_at": "2026-02-06T20:36:03.285004Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008679389953613281, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.not_null_payments_PAYMENT_ID.fccc2c535c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect PAYMENT_ID\nfrom AI_FACTORY_DB.SILVER.payments\nwhere PAYMENT_ID is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.282550Z", "completed_at": "2026-02-06T20:36:03.287009Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.287290Z", "completed_at": "2026-02-06T20:36:03.287293Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007682085037231445, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ai_factory.unique_payments_PAYMENT_ID.bdc007cc63", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    PAYMENT_ID as unique_field,\n    count(*) as n_records\n\nfrom AI_FACTORY_DB.SILVER.payments\nwhere PAYMENT_ID is not null\ngroup by PAYMENT_ID\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.285281Z", "completed_at": "2026-02-06T20:36:03.287643Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.287806Z", "completed_at": "2026-02-06T20:36:03.287810Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0035507678985595703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.provider_360", "compiled": true, "compiled_code": "\n\n/*\n    Gold Provider 360\n    -----------------\n    Complete provider profile combining all data sources.\n    Single source of truth for provider analysis.\n*/\n\nwith provider as (\n    select * from AI_FACTORY_DB.SILVER.provider\n),\n\npayments_summary as (\n    select * from AI_FACTORY_DB.GOLD.payments_summary\n),\n\nprescriptions_summary as (\n    select * from AI_FACTORY_DB.GOLD.prescriptions_summary\n),\n\nexcluded as (\n    select\n        NPI,\n        EXCLUSION_REASON,\n        EXCLUSION_DATE,\n        IS_CURRENTLY_EXCLUDED,\n        IS_HIGH_RISK as IS_EXCLUDED_HIGH_RISK\n    from AI_FACTORY_DB.SILVER.excluded_providers\n    where NPI is not null\n),\n\nfinal as (\n    select\n        -- Provider identity\n        p.NPI,\n        p.ENTITY_TYPE,\n        p.FULL_NAME,\n        p.ORGANIZATION_NAME,\n        p.CREDENTIAL,\n        p.GENDER,\n\n        -- Location\n        p.CITY,\n        p.STATE,\n        p.ZIP_CODE,\n        p.PHONE,\n\n        -- Specialty\n        p.SPECIALTY_CLASSIFICATION,\n        p.SPECIALTY,\n        p.PROVIDER_TYPE,\n\n        -- NPI Status\n        p.IS_NPI_ACTIVE,\n        p.NPI_ENUMERATION_DATE,\n\n        -- Exclusion info\n        p.IS_EXCLUDED,\n        e.EXCLUSION_REASON,\n        e.EXCLUSION_DATE,\n        e.IS_CURRENTLY_EXCLUDED,\n        COALESCE(e.IS_EXCLUDED_HIGH_RISK, false) as IS_EXCLUDED_HIGH_RISK,\n\n        -- Payment metrics\n        COALESCE(pay.TOTAL_PAYMENTS, 0) as TOTAL_PAYMENTS,\n        COALESCE(pay.TOTAL_PAYMENT_AMOUNT, 0) as TOTAL_PAYMENT_AMOUNT,\n        COALESCE(pay.UNIQUE_PAYERS, 0) as UNIQUE_PAYERS,\n        pay.RECIPIENT_TIER,\n        COALESCE(pay.PCT_HIGH_RISK_PAYMENTS, 0) as PCT_HIGH_RISK_PAYMENTS,\n        pay.FIRST_PAYMENT_DATE,\n        pay.LAST_PAYMENT_DATE,\n\n        -- Prescription metrics\n        COALESCE(rx.TOTAL_CLAIMS, 0) as TOTAL_PRESCRIPTION_CLAIMS,\n        COALESCE(rx.TOTAL_COST, 0) as TOTAL_PRESCRIPTION_COST,\n        COALESCE(rx.UNIQUE_DRUGS_PRESCRIBED, 0) as UNIQUE_DRUGS_PRESCRIBED,\n        COALESCE(rx.PCT_BRAND_CLAIMS, 0) as PCT_BRAND_CLAIMS,\n        rx.PRESCRIBER_VOLUME_TIER,\n        COALESCE(rx.TOTAL_HIGH_RISK_DRUGS, 0) as TOTAL_HIGH_RISK_DRUGS,\n\n        -- Activity flags\n        case when pay.NPI is not null then true else false end as HAS_PHARMA_PAYMENTS,\n        case when rx.NPI is not null then true else false end as HAS_PRESCRIPTIONS,\n\n        -- Combined financial exposure\n        COALESCE(pay.TOTAL_PAYMENT_AMOUNT, 0) + COALESCE(rx.TOTAL_COST, 0) as TOTAL_FINANCIAL_EXPOSURE,\n\n        current_timestamp() as _loaded_at\n\n    from provider p\n    left join payments_summary pay on p.NPI = pay.NPI\n    left join prescriptions_summary rx on p.NPI = rx.NPI\n    left join excluded e on p.NPI = e.NPI\n)\n\nselect * from final", "relation_name": "AI_FACTORY_DB.GOLD.provider_360", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.288842Z", "completed_at": "2026-02-06T20:36:03.290397Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.290571Z", "completed_at": "2026-02-06T20:36:03.290574Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0021562576293945312, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.fraud_risk_score", "compiled": true, "compiled_code": "\n\n/*\n    Gold Fraud Risk Score\n    ---------------------\n    Composite fraud risk scoring for each provider.\n    Combines multiple risk signals into a single score.\n\n    Scoring methodology:\n    - Base score: 0\n    - Each risk factor adds points\n    - Final score: 0-100 scale\n    - Higher = more suspicious\n*/\n\nwith provider_360 as (\n    select * from AI_FACTORY_DB.GOLD.provider_360\n),\n\nrisk_calculation as (\n    select\n        NPI,\n        FULL_NAME,\n        ORGANIZATION_NAME,\n        ENTITY_TYPE,\n        SPECIALTY,\n        STATE,\n\n        -- Start with base score of 0\n        0\n\n        -- EXCLUSION RISKS (High weight - 40 points max)\n        + case when IS_EXCLUDED then 25 else 0 end\n        + case when IS_EXCLUDED_HIGH_RISK then 15 else 0 end  -- Excluded but still active\n\n        -- PAYMENT RISKS (20 points max)\n        + case\n            when RECIPIENT_TIER = 'MEGA_RECIPIENT' then 10\n            when RECIPIENT_TIER = 'MAJOR_RECIPIENT' then 5\n            else 0\n          end\n        + case when PCT_HIGH_RISK_PAYMENTS >= 50 then 10 else PCT_HIGH_RISK_PAYMENTS / 10 end\n\n        -- PRESCRIPTION RISKS (20 points max)\n        + case when PCT_BRAND_CLAIMS >= 80 then 10 else PCT_BRAND_CLAIMS / 10 end\n        + case when TOTAL_HIGH_RISK_DRUGS >= 10 then 10 else TOTAL_HIGH_RISK_DRUGS end\n\n        -- ACTIVITY ANOMALIES (20 points max)\n        + case\n            when HAS_PHARMA_PAYMENTS and HAS_PRESCRIPTIONS then 10  -- Both activities\n            else 0\n          end\n        + case when IS_NPI_ACTIVE = false and (HAS_PHARMA_PAYMENTS or HAS_PRESCRIPTIONS) then 10 else 0 end\n\n        as RAW_RISK_SCORE,\n\n        -- Individual risk components for transparency\n        IS_EXCLUDED,\n        IS_EXCLUDED_HIGH_RISK,\n        RECIPIENT_TIER,\n        PCT_HIGH_RISK_PAYMENTS,\n        PCT_BRAND_CLAIMS,\n        TOTAL_HIGH_RISK_DRUGS,\n        HAS_PHARMA_PAYMENTS,\n        HAS_PRESCRIPTIONS,\n        IS_NPI_ACTIVE,\n        TOTAL_PAYMENT_AMOUNT,\n        TOTAL_PRESCRIPTION_COST,\n        TOTAL_FINANCIAL_EXPOSURE\n\n    from provider_360\n),\n\nfinal as (\n    select\n        NPI,\n        FULL_NAME,\n        ORGANIZATION_NAME,\n        ENTITY_TYPE,\n        SPECIALTY,\n        STATE,\n\n        -- Normalized score (0-100)\n        LEAST(ROUND(RAW_RISK_SCORE, 0), 100) as FRAUD_RISK_SCORE,\n\n        -- Risk tier\n        case\n            when RAW_RISK_SCORE >= 70 then 'CRITICAL'\n            when RAW_RISK_SCORE >= 50 then 'HIGH'\n            when RAW_RISK_SCORE >= 30 then 'MEDIUM'\n            when RAW_RISK_SCORE >= 10 then 'LOW'\n            else 'MINIMAL'\n        end as RISK_TIER,\n\n        -- Risk flags (for filtering)\n        IS_EXCLUDED,\n        IS_EXCLUDED_HIGH_RISK,\n        case when PCT_BRAND_CLAIMS >= 80 then true else false end as IS_HIGH_BRAND_PRESCRIBER,\n        case when RECIPIENT_TIER in ('MEGA_RECIPIENT', 'MAJOR_RECIPIENT') then true else false end as IS_MAJOR_PAYMENT_RECIPIENT,\n\n        -- Financial metrics\n        TOTAL_PAYMENT_AMOUNT,\n        TOTAL_PRESCRIPTION_COST,\n        TOTAL_FINANCIAL_EXPOSURE,\n\n        -- Component scores (for analysis)\n        RECIPIENT_TIER,\n        PCT_HIGH_RISK_PAYMENTS,\n        PCT_BRAND_CLAIMS,\n        TOTAL_HIGH_RISK_DRUGS,\n\n        -- Activity\n        HAS_PHARMA_PAYMENTS,\n        HAS_PRESCRIPTIONS,\n        IS_NPI_ACTIVE,\n\n        current_timestamp() as _loaded_at\n\n    from risk_calculation\n)\n\nselect * from final", "relation_name": "AI_FACTORY_DB.GOLD.fraud_risk_score", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-02-06T20:36:03.291476Z", "completed_at": "2026-02-06T20:36:03.294674Z"}, {"name": "execute", "started_at": "2026-02-06T20:36:03.294841Z", "completed_at": "2026-02-06T20:36:03.294845Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003722667694091797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ai_factory.high_risk_alerts", "compiled": true, "compiled_code": "\n\n/*\n    Gold High Risk Alerts\n    ---------------------\n    Actionable alerts for fraud investigation.\n    Each row = one alert requiring review.\n*/\n\nwith fraud_scores as (\n    select * from AI_FACTORY_DB.GOLD.fraud_risk_score\n),\n\nexcluded_providers as (\n    select * from AI_FACTORY_DB.SILVER.excluded_providers\n    where IS_CURRENTLY_EXCLUDED = true\n),\n\npayments as (\n    select * from AI_FACTORY_DB.SILVER.payments\n    where IS_RECIPIENT_EXCLUDED = true\n),\n\nprescriptions as (\n    select * from AI_FACTORY_DB.SILVER.prescriptions\n    where IS_PRESCRIBER_EXCLUDED = true\n),\n\n-- Alert Type 1: High Risk Score Providers\nhigh_risk_score_alerts as (\n    select\n        md5(cast(coalesce(cast(NPI as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast('HIGH_RISK_SCORE' as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as ALERT_ID,\n        'HIGH_RISK_SCORE' as ALERT_TYPE,\n        NPI,\n        COALESCE(FULL_NAME, ORGANIZATION_NAME) as PROVIDER_NAME,\n        SPECIALTY,\n        STATE,\n        FRAUD_RISK_SCORE as RISK_SCORE,\n        RISK_TIER,\n        'Provider has fraud risk score of ' || FRAUD_RISK_SCORE || ' (' || RISK_TIER || ')' as ALERT_DESCRIPTION,\n        TOTAL_FINANCIAL_EXPOSURE as FINANCIAL_EXPOSURE,\n        'PENDING' as ALERT_STATUS,\n        current_date() as ALERT_DATE\n    from fraud_scores\n    where RISK_TIER in ('CRITICAL', 'HIGH')\n),\n\n-- Alert Type 2: Excluded Provider Still Active\nexcluded_still_active_alerts as (\n    select\n        md5(cast(coalesce(cast(NPI as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast('EXCLUDED_STILL_ACTIVE' as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as ALERT_ID,\n        'EXCLUDED_STILL_ACTIVE' as ALERT_TYPE,\n        NPI,\n        COALESCE(NPPES_FULL_NAME, LAST_NAME || ' ' || FIRST_NAME) as PROVIDER_NAME,\n        PROVIDER_SPECIALTY as SPECIALTY,\n        STATE,\n        100 as RISK_SCORE,\n        'CRITICAL' as RISK_TIER,\n        'Provider excluded on ' || EXCLUSION_DATE || ' for \"' || EXCLUSION_REASON || '\" but still active in NPPES' as ALERT_DESCRIPTION,\n        null as FINANCIAL_EXPOSURE,\n        'PENDING' as ALERT_STATUS,\n        current_date() as ALERT_DATE\n    from excluded_providers\n    where IS_HIGH_RISK = true\n),\n\n-- Alert Type 3: Payments to Excluded Providers\npayments_to_excluded_alerts as (\n    select\n        md5(cast(coalesce(cast(NPI as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(PAYER_NAME as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast('PAYMENT_TO_EXCLUDED' as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as ALERT_ID,\n        'PAYMENT_TO_EXCLUDED' as ALERT_TYPE,\n        NPI,\n        FULL_NAME as PROVIDER_NAME,\n        SPECIALTY,\n        STATE,\n        90 as RISK_SCORE,\n        'CRITICAL' as RISK_TIER,\n        'Excluded provider received ' || COUNT(*) || ' payments totaling $' || ROUND(SUM(PAYMENT_AMOUNT), 2) || ' from ' || PAYER_NAME as ALERT_DESCRIPTION,\n        SUM(PAYMENT_AMOUNT) as FINANCIAL_EXPOSURE,\n        'PENDING' as ALERT_STATUS,\n        current_date() as ALERT_DATE\n    from payments\n    where NPI is not null\n    group by NPI, FULL_NAME, SPECIALTY, STATE, PAYER_NAME\n),\n\n-- Alert Type 4: Prescriptions by Excluded Providers\nprescriptions_by_excluded_alerts as (\n    select\n        md5(cast(coalesce(cast(NPI as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast('PRESCRIPTION_BY_EXCLUDED' as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as ALERT_ID,\n        'PRESCRIPTION_BY_EXCLUDED' as ALERT_TYPE,\n        NPI,\n        PRESCRIBER_FULL_NAME as PROVIDER_NAME,\n        PRESCRIBER_TYPE as SPECIALTY,\n        STATE,\n        95 as RISK_SCORE,\n        'CRITICAL' as RISK_TIER,\n        'Excluded provider prescribed ' || SUM(TOTAL_CLAIMS) || ' claims totaling $' || ROUND(SUM(TOTAL_DRUG_COST), 2) as ALERT_DESCRIPTION,\n        SUM(TOTAL_DRUG_COST) as FINANCIAL_EXPOSURE,\n        'PENDING' as ALERT_STATUS,\n        current_date() as ALERT_DATE\n    from prescriptions\n    where NPI is not null\n    group by NPI, PRESCRIBER_FULL_NAME, PRESCRIBER_TYPE, STATE\n),\n\n-- Alert Type 5: High Brand Prescribers (potential kickback indicator)\nhigh_brand_alerts as (\n    select\n        md5(cast(coalesce(cast(NPI as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast('HIGH_BRAND_PRESCRIBER' as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as ALERT_ID,\n        'HIGH_BRAND_PRESCRIBER' as ALERT_TYPE,\n        NPI,\n        COALESCE(FULL_NAME, ORGANIZATION_NAME) as PROVIDER_NAME,\n        SPECIALTY,\n        STATE,\n        FRAUD_RISK_SCORE as RISK_SCORE,\n        'HIGH' as RISK_TIER,\n        'Provider has ' || PCT_BRAND_CLAIMS || '% brand prescription rate (potential kickback indicator)' as ALERT_DESCRIPTION,\n        TOTAL_PRESCRIPTION_COST as FINANCIAL_EXPOSURE,\n        'PENDING' as ALERT_STATUS,\n        current_date() as ALERT_DATE\n    from fraud_scores\n    where IS_HIGH_BRAND_PRESCRIBER = true\n      and NOT IS_EXCLUDED  -- Excluded providers already have alerts\n),\n\nall_alerts as (\n    select * from high_risk_score_alerts\n    union all\n    select * from excluded_still_active_alerts\n    union all\n    select * from payments_to_excluded_alerts\n    union all\n    select * from prescriptions_by_excluded_alerts\n    union all\n    select * from high_brand_alerts\n),\n\nfinal as (\n    select\n        ALERT_ID,\n        ALERT_TYPE,\n        NPI,\n        PROVIDER_NAME,\n        SPECIALTY,\n        STATE,\n        RISK_SCORE,\n        RISK_TIER,\n        ALERT_DESCRIPTION,\n        FINANCIAL_EXPOSURE,\n        ALERT_STATUS,\n        ALERT_DATE,\n\n        -- Priority ranking\n        case\n            when ALERT_TYPE = 'EXCLUDED_STILL_ACTIVE' then 1\n            when ALERT_TYPE = 'PRESCRIPTION_BY_EXCLUDED' then 2\n            when ALERT_TYPE = 'PAYMENT_TO_EXCLUDED' then 3\n            when ALERT_TYPE = 'HIGH_RISK_SCORE' and RISK_TIER = 'CRITICAL' then 4\n            when ALERT_TYPE = 'HIGH_BRAND_PRESCRIBER' then 5\n            else 6\n        end as PRIORITY_RANK,\n\n        current_timestamp() as _loaded_at\n\n    from all_alerts\n)\n\nselect * from final\norder by PRIORITY_RANK, RISK_SCORE desc", "relation_name": "AI_FACTORY_DB.GOLD.high_risk_alerts", "batch_results": null}], "elapsed_time": 2.379903793334961, "args": {"source_freshness_run_project_hooks": true, "strict_mode": false, "use_colors_file": true, "require_resource_names_without_spaces": true, "log_file_max_bytes": 10485760, "require_batched_execution_for_custom_microbatch_strategy": false, "show_all_deprecations": false, "state_modified_compare_more_unrendered_values": false, "favor_state": false, "send_anonymous_usage_stats": true, "require_generic_test_arguments_property": true, "log_level": "info", "require_ref_searches_node_package_before_root": false, "log_format": "default", "static": false, "defer": false, "require_nested_cumulative_type_params": false, "exclude": [], "require_yaml_configuration_for_mf_time_spines": false, "require_unique_project_resource_names": false, "invocation_command": "dbt docs generate --profiles-dir /opt/airflow/dbt", "skip_nodes_if_on_run_start_fails": false, "vars": {}, "warn_error_options": {"error": [], "warn": [], "silence": []}, "cache_selected_only": false, "empty_catalog": false, "quiet": false, "require_explicit_package_overrides_for_builtin_materializations": true, "partial_parse": true, "project_dir": "/opt/airflow/dbt", "populate_cache": true, "printer_width": 80, "upload_to_artifacts_ingest_api": false, "require_all_warnings_handled_by_warn_error": false, "show_resource_report": false, "log_path": "/opt/airflow/dbt/logs", "validate_macro_args": false, "print": true, "which": "generate", "write_json": true, "profiles_dir": "/opt/airflow/dbt", "select": [], "introspect": true, "indirect_selection": "eager", "use_colors": true, "version_check": true, "log_level_file": "debug", "partial_parse_file_diff": true, "state_modified_compare_vars": false, "static_parser": true, "log_format_file": "debug", "use_fast_test_edges": false, "macro_debugging": false, "compile": true}}